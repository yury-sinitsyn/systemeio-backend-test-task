# Symfony REST-приложение для расчета цены продукта и проведения оплаты

Данное Symfony REST-приложение предоставляет два основных эндпоинта для расчета цен на продукты и обработки покупок. Приложение включает валидацию данных запроса, расчет скидок и налогов, а также обработку платежей с использованием PayPal и Stripe.

## Требования

- Docker
- Docker Compose
- Make

## Начало работы

Чтобы начать работу с проектом, выполните следующие шаги:

1. Клонируйте репозиторий:

   ```bash
   git clone <repository_url>
   cd <repository_name>
   ```

2. Инициализируйте проект и запустите Docker-контейнер:

   ```bash
   make init
   make reset-db
   ```

Эта команда настроит Symfony-приложение, смонтирует текущую директорию в контейнер и запустит приложение на порту `8337`.

## Эндпоинты

### Расчет цены

- **URL**: `http://127.0.0.1:8337/calculate-price`
- **Метод**: `POST`
- **Тело запроса**:

  ```json
  {
      "product": 1,
      "taxNumber": "DE123456789",
      "couponCode": "D15"
  }
  ```

- **Ответ**:
  - **200 OK**: Успешный расчет цены.
  - **400 Bad Request**: Неверные входные данные.

### Покупка

- **URL**: `http://127.0.0.1:8337/purchase`
- **Метод**: `POST`
- **Тело запроса**:

  ```json
  {
      "product": 1,
      "taxNumber": "IT12345678900",
      "couponCode": "D15",
      "paymentProcessor": "paypal"
  }
  ```

- **Ответ**:
  - **200 OK**: Успешная покупка.
  - **400 Bad Request**: Неверные входные данные или ошибка оплаты.

## Продукты

Продукты хранятся в базе данных со следующими примерами данных:

- **Iphone**: 100 евро
- **Наушники**: 20 евро
- **Чехол**: 10 евро

## Купоны

Купоны хранятся в системе и могут быть двух типов:

- Фиксированная сумма скидки
- Процент от суммы покупки

Примеры:

- `P10`: скидка 10%
- `P100`: скидка 100%

## Расчет налога

Налог рассчитывается исходя из кода страны в налоговом номере:

- **Германия**: 19%
- **Италия**: 22%
- **Франция**: 20%
- **Греция**: 24%

## Валидация

Приложение использует Symfony Validator для валидации входных данных, включая форматы налоговых номеров:

- **Германия**: `DEXXXXXXXXX`
- **Италия**: `ITXXXXXXXXXXX`
- **Греция**: `GRXXXXXXXXX`
- **Франция**: `FRYYXXXXXXXXX`

## Обработка платежей

Приложение поддерживает обработку платежей через PayPal и Stripe с использованием предоставленных классов:

- `PaypalPaymentProcessor::pay()`
- `StripePaymentProcessor::processPayment()`

## Тестирование

Для тестирования приложения вы можете использовать файл `requests.http`, который находится в корне проекта. Этот файл содержит пример HTTP-запросов для обоих эндпоинтов. Используйте HTTP-клиенты, такие как [HTTPie](https://httpie.io/) или [Postman](https://www.postman.com/), чтобы выполнить эти запросы.
Кроме того, для запуска тестов используйте следующую команду:
   ```bash
   make test
   ```

## Возможные улучшения

Хотя текущая реализация покрывает основные требования, можно сделать несколько улучшений:

1. **Интеграция OpenAPI**: Использовать OpenAPI для документирования и тестирования API эндпоинтов.
2. **Эндпоинты для управления сущностями**: Добавить эндпоинты для управления продуктами, купонами, заказами и платежами.
3. **Сущности заказов и платежей**: Реализовать сущности для заказов и платежей и хранить их в базе данных.
4. **Расширенная валидация**: Улучшить логику валидации для сложных случаев.
5. **Юнит и интеграционные тесты**: Добавить PHPUnit тесты для обеспечения надежности кода.
6. **Принципы SOLID**: Рефакторинг кода в строгом соответствии с принципами SOLID для улучшения поддерживаемости.

## Заключение

Этот проект демонстрирует функциональную реализацию требуемых REST-эндпоинтов для расчета цен на продукты и обработки покупок. Приложение контейнеризировано для удобной настройки и тестирования, включает базовую валидацию входных данных и функциональность обработки платежей.

По любым вопросам или предложениям по улучшению, пожалуйста, свяжитесь со мной.

---

Следуя этому руководству, вы сможете настроить, запустить и протестировать Symfony REST-приложение эффективно.